–ö–æ–≥–¥–∞ SQL Server –Ω–∞—á–∏–Ω–∞–µ—Ç —Ç–æ—Ä–º–æ–∑–∏—Ç—å, –≤–∞–∂–Ω–æ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω–æ, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ –ø—Ä–∏—á–∏–Ω—É –∏ –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞ –Ω–µ–Ω—É–∂–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏. –í–æ—Ç –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —Å –æ–ø—ã—Ç–æ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤. –ï–≥–æ —Å—É—Ç—å ‚Äî –æ—Ç—Å–µ–∫–∞—Ç—å —Ü–µ–ª—ã–µ –∫–ª–∞—Å—Å—ã –ø—Ä–æ–±–ª–µ–º, –¥–≤–∏–≥–∞—è—Å—å –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º –ø—Ä–∏—á–∏–Ω–∞–º.

```mermaid
flowchart TD
    A["üö® SQL Server –Ω–∞—á–∞–ª —Ç–æ—Ä–º–æ–∑–∏—Ç—å"] --> B{"–ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–º<br>–≤ —Ü–µ–ª–æ–º? (–û–°, –¥–∏—Å–∫, –¶–ü)"}
    B -- –î–∞ --> C["–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —É—Ä–æ–≤–Ω—è –û–°:<br>Perfmon, –î–∏—Å–ø–µ—Ç—á–µ—Ä –∑–∞–¥–∞—á"]
    B -- –ù–µ—Ç<br>–õ–æ–∫–∞–ª—å–Ω–æ –≤ SQL --> D["–ê–Ω–∞–ª–∏–∑ –æ–∂–∏–¥–∞–Ω–∏–π (Waits)<br>—á–µ—Ä–µ–∑ sys.dm_os_wait_stats<br>–ö–ª—é—á –∫ –ø–æ–Ω–∏–º–∞–Ω–∏—é —É–∑–∫–æ–≥–æ –º–µ—Å—Ç–∞"]

    C --> E{"–í—ã—Å–æ–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–∏—Å–∫–∞?<br>Avg. Disk sec/Read > 10-15 –º—Å "}
    E -- –î–∞ --> F["–ü—Ä–æ–±–ª–µ–º–∞ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞<br>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—á–µ—Ä–µ–¥—å –¥–∏—Å–∫–∞,<br>–∞–Ω—Ç–∏–≤–∏—Ä—É—Å, SAN, –¥—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"]
    E -- –ù–µ—Ç --> G{"–í—ã—Å–æ–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¶–ü?<br>–ü—Ä–æ—Ü–µ—Å—Å sqlservr.exe"}
    G -- –î–∞ --> H["–ü—Ä–æ–±–ª–µ–º–∞ –¶–ü<br>–ò—Å–∫–∞—Ç—å —Ç—è–∂–µ–ª—ã–µ –∑–∞–ø—Ä–æ—Å—ã<br>–≤ sys.dm_exec_query_stats"]
    G -- –ù–µ—Ç --> I["–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞–º—è—Ç—å –∏ —Å–µ—Ç—å<br>(Memory\\Available MB,<br>ASYNC_NETWORK_IO)"]

    D --> J{"–ö–∞–∫–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –ª–∏–¥–∏—Ä—É—é—Ç?"}
    J -- "PAGEIOLATCH_*" --> K["–¢–æ—á–Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ —Å –¥–∏—Å–∫–æ–º<br>–£–≥–ª—É–±–ª–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ I/O<br>—á–µ—Ä–µ–∑ sys.dm_io_virtual_file_stats"]
    J -- "LCK_M_*" --> L["–ü—Ä–æ–±–ª–µ–º–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫<br>–ò—Å–∫–∞—Ç—å –≥–æ–ª–æ–≤–Ω–æ–π –±–ª–æ–∫–∏—Ä—É—é—â–∏–π<br>–ø—Ä–æ—Ü–µ—Å—Å —á–µ—Ä–µ–∑ sp_whoisactive"]
    J -- "SOS_SCHEDULER_YIELD" --> M["–î–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –¶–ü<br>–°–º. –ø—É—Ç—å –∞–Ω–∞–ª–∏–∑–∞ –¶–ü"]
    J -- "WRITELOG" --> N["–ü—Ä–æ–±–ª–µ–º–∞ –∂—É—Ä–Ω–∞–ª–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π<br>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –∑–∞–ø–∏—Å–∏ –ª–æ–≥–∞,<br>—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—é VLF"]
    J -- "RESOURCE_SEMAPHORE" --> O["–ù–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤<br>–ê–Ω–∞–ª–∏–∑ memory grants,<br>–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—â—É—é –ø–∞–º—è—Ç—å –û–°"]
    
    F & H & I & K & L & M & N & O --> P["üìä –û–±—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ SQL<br>(–µ—Å–ª–∏ –ø—Ä–∏—á–∏–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞)"]
    
    P --> Q["–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É<br>–∏ –ø–µ—Ä–µ—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã<br>(—á–∞—Å—Ç—ã–π —Ç—Ä–∏–≥–≥–µ—Ä –≤–Ω–µ–∑–∞–ø–Ω—ã—Ö —Ç–æ—Ä–º–æ–∑–æ–≤)"]
    Q --> R["–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –Ω–∞–ª–∏—á–∏–µ<br>–¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (blocking)"]
    R --> S["–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–∞–º—ã–µ<br>—Ä–µ—Å—É—Ä—Å–æ–µ–º–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã<br>–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è"]
    S --> T["–ò—Å–∫–∞—Ç—å –≤ –ª–æ–≥–∞—Ö –æ—à–∏–±–æ–∫<br>(–æ—à–∏–±–∫–∞ 833, long I/O)"]
```

### üéØ –®–∞–≥ 1: –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —É—Ä–æ–≤–Ω—è –û–° –∏ SQL

–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º, –≥–¥–µ –∏—Å–∫–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É: –≤ —Ü–µ–ª–æ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–û–°, –¥–∏—Å–∫, –¶–ü) –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ –≤ SQL Server.

**1. –ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–º –≤ —Ü–µ–ª–æ–º?**
- **–°–∏–º–ø—Ç–æ–º—ã**: –º–µ–¥–ª–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –º—ã—à—å, –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç RDP, —Ç–æ—Ä–º–æ–∑—è—Ç –≤—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
- **–ß—Ç–æ –¥–µ–ª–∞—Ç—å**: –û—Ç–∫—Ä–æ–π—Ç–µ **–î–∏—Å–ø–µ—Ç—á–µ—Ä –∑–∞–¥–∞—á** –∏–ª–∏ **–ú–æ–Ω–∏—Ç–æ—Ä —Ä–µ—Å—É—Ä—Å–æ–≤**. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ:
    - **–î–∏—Å–∫**: –ó–∞–≥—Ä—É–∑–∫–∞ 100%, –≤—ã—Å–æ–∫–∞—è **—Å—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ –æ—á–µ—Ä–µ–¥–∏** (–±–æ–ª–µ–µ 2-5 –¥–ª—è HDD, –±–æ–ª–µ–µ 10-20 –¥–ª—è SSD ‚Äî —É–∂–µ —Ç—Ä–µ–≤–æ–∂–Ω–æ). –ö–ª—é—á–µ–≤–æ–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å ‚Äî **Avg. Disk sec/Read** (—Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —á—Ç–µ–Ω–∏—è —Å –¥–∏—Å–∫–∞). –ó–Ω–∞—á–µ–Ω–∏–µ **–±–æ–ª–µ–µ 10-15 –º—Å** ‚Äî —è–≤–Ω—ã–π –ø—Ä–∏–∑–Ω–∞–∫ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥—Å–∏—Å—Ç–µ–º–æ–π –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞.
    - **–¶–ü**: –ó–∞–≥—Ä—É–∂–µ–Ω –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å **sqlservr.exe**? –ï—Å–ª–∏ –¥–∞, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –∞–Ω–∞–ª–∏–∑—É –∑–∞–ø—Ä–æ—Å–æ–≤. –ï—Å–ª–∏ –Ω–µ—Ç, –≤–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ –≤ –¥—Ä—É–≥–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ.
    - **–ü–∞–º—è—Ç—å**: –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ —Å–≤–æ–±–æ–¥–Ω–æ–π –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ (**Memory\Available MBytes**)? SQL Server –±—É–¥–µ—Ç —Å—Ç—Ä–∞–¥–∞—Ç—å, –µ—Å–ª–∏ —Å–∏—Å—Ç–µ–º–µ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –ø–∞–º—è—Ç–∏.

**2. –ü—Ä–æ–±–ª–µ–º–∞ –ª–æ–∫–∞–ª—å–Ω–æ –≤ SQL Server?**
–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–∞–∑–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ **—Ç–∏–ø–æ–≤ –æ–∂–∏–¥–∞–Ω–∏–π (wait types)** ‚Äî —ç—Ç–æ –≥–ª–∞–≤–Ω—ã–π –∫–ª—é—á –∫ –ø–æ–Ω–∏–º–∞–Ω–∏—é, –Ω–∞ —á–µ–º "–∑–∞—Å—Ç—Ä—è–ª" —Å–µ—Ä–≤–µ—Ä.

```sql
-- –ö–∞–∫–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ?
SELECT TOP 10 wait_type, waiting_tasks_count, wait_time_ms
FROM sys.dm_os_wait_stats
WHERE wait_type NOT IN ('CLR_SEMAPHORE', 'LAZYWRITER_SLEEP', 'RESOURCE_QUEUE', 'SLEEP_TASK',
                        'SOS_WORK_DISPATCHER', 'XE_DISPATCHER_WAIT', 'XE_TIMER_EVENT', 'DIRTY_PAGE_POLL')
ORDER BY wait_time_ms DESC;
```
**–ö–∞–∫ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç (Top Waits)**:
- **`PAGEIOLATCH_*`** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `SH`, `EX`): –ñ–¥—É—Ç –¥–∞–Ω–Ω—ã–µ —Å –¥–∏—Å–∫–∞. –Ø–≤–Ω—ã–π –ø—Ä–∏–∑–Ω–∞–∫ **–ø—Ä–æ–±–ª–µ–º—ã —Å I/O** –∏–ª–∏ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –ø–∞–º—è—Ç–∏ (–¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–º–µ—â–∞—é—Ç—Å—è –≤ –∫—ç—à).
- **`LCK_M_*`** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `LCK_M_S`, `LCK_M_U`): –û–∂–∏–¥–∞–Ω–∏–µ **–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**. –£–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—é –∑–∞ –¥–∞–Ω–Ω—ã–µ, –≤–æ–∑–º–æ–∂–Ω–æ, –¥–ª–∏–Ω–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.
- **`WRITELOG`**: –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ **–∂—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**. –ú–µ–¥–ª–µ–Ω–Ω—ã–π –¥–∏—Å–∫ –¥–ª—è –ª–æ–≥–∞ –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –º–∞–ª–µ–Ω—å–∫–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.
- **`ASYNC_NETWORK_IO`**: –ß–∞—Å—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–±–ª–µ–º—É **—Å–µ—Ç–∏** –∏–ª–∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–±–∏—Ä–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.
- **`CXPACKET`**: –û–∂–∏–¥–∞–Ω–∏–µ, —Å–≤—è–∑–∞–Ω–Ω–æ–µ —Å **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º** –∑–∞–ø—Ä–æ—Å–æ–≤. –ú–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏.
- **`SOS_SCHEDULER_YIELD`**: –ó–∞–¥–∞—á–∏ –¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ —É—Å—Ç—É–ø–∞—é—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä, –æ–∂–∏–¥–∞—è —Å–≤–æ–µ–π –æ—á–µ—Ä–µ–¥–∏. –ú–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ **–¥–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –¶–ü**.
- **`RESOURCE_SEMAPHORE`**: –û–∂–∏–¥–∞–Ω–∏–µ **–≤—ã–¥–µ–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏** –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏–ª–∏ —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è).

### üîç –®–∞–≥ 2: –£–≥–ª—É–±–ª–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é

–û–ø—Ä–µ–¥–µ–ª–∏–≤ –æ–±–ª–∞—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –¥–µ—Ç–∞–ª—å–Ω–æ–º—É –∞–Ω–∞–ª–∏–∑—É.

**–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å I/O (PAGEIOLATCH, –≤—ã—Å–æ–∫–∏–π Avg. Disk sec)**
1.  **–£–∑–Ω–∞–π—Ç–µ, –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã —Ç–æ—Ä–º–æ–∑—è—Ç**:
    ```sql
    -- –ó–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ñ–∞–π–ª–æ–≤ –ë–î
    SELECT DB_NAME(vfs.database_id) AS DB,
           mf.physical_name,
           CASE WHEN num_of_reads > 0 
                THEN (io_stall_read_ms / num_of_reads) 
                ELSE 0 END AS [Avg Read Latency (ms)],
           CASE WHEN num_of_writes > 0 
                THEN (io_stall_write_ms / num_of_writes) 
                ELSE 0 END AS [Avg Write Latency (ms)]
    FROM sys.dm_io_virtual_file_stats(NULL, NULL) AS vfs
    JOIN sys.master_files AS mf ON vfs.database_id = mf.database_id 
                                   AND vfs.file_id = mf.file_id
    ORDER BY [Avg Read Latency (ms)] DESC;
    ```
2.  **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ/—Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã**: –ê–Ω—Ç–∏–≤–∏—Ä—É—Å, —Å–∫–∞–Ω–∏—Ä—É—é—â–∏–π —Ñ–∞–π–ª—ã –ë–î? –î—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≥—Ä—É–∑—è—Ç –¥–∏—Å–∫? –ü—Ä–æ–±–ª–µ–º—ã —Å SAN/–¥—Ä–∞–π–≤–µ—Ä–∞–º–∏? –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç—å –ø–∞–ø–∫–∏ —Å –¥–∞–Ω–Ω—ã–º–∏ –∏ –ª–æ–≥–∞–º–∏ SQL –∏–∑ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏.
3.  **–ù–∞–π–¥–∏—Ç–µ "–ø—Ä–æ–∂–æ—Ä–ª–∏–≤—ã–µ" –∑–∞–ø—Ä–æ—Å—ã**, –≤—ã–∑—ã–≤–∞—é—â–∏–µ –º–Ω–æ–≥–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —á—Ç–µ–Ω–∏–π:
    ```sql
    SELECT TOP 10 qs.execution_count,
           qs.total_logical_reads / qs.execution_count AS avg_logical_reads,
           qs.total_physical_reads / qs.execution_count AS avg_physical_reads,
           SUBSTRING(st.text, (qs.statement_start_offset/2) + 1,
           ((CASE qs.statement_end_offset WHEN -1 THEN DATALENGTH(st.text)
            ELSE qs.statement_end_offset END - qs.statement_start_offset)/2) + 1) AS query_text
    FROM sys.dm_exec_query_stats AS qs
    CROSS APPLY sys.dm_exec_sql_text(qs.sql_handle) AS st
    ORDER BY qs.total_physical_reads DESC;
    ```

**–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å –¶–ü (–≤—ã—Å–æ–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ sqlservr.exe, SOS_SCHEDULER_YIELD)**
–ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å—ã, –ø–æ—Ç—Ä–µ–±–ª—è—é—â–∏–µ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏:
```sql
SELECT TOP 10 qs.execution_count,
       qs.total_worker_time / qs.execution_count AS avg_cpu_time,
       qs.total_worker_time AS total_cpu_time,
       SUBSTRING(st.text, (qs.statement_start_offset/2) + 1,
       ((CASE qs.statement_end_offset WHEN -1 THEN DATALENGTH(st.text)
        ELSE qs.statement_end_offset END - qs.statement_start_offset)/2) + 1) AS query_text
FROM sys.dm_exec_query_stats AS qs
CROSS APPLY sys.dm_exec_sql_text(qs.sql_handle) AS st
ORDER BY qs.total_worker_time DESC;
```
–î–∞–ª–µ–µ —Å–º–æ—Ç—Ä–∏—Ç–µ –ø–ª–∞–Ω—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –≤–æ–∑–º–æ–∂–Ω–æ, –∏–º –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –∏–Ω–¥–µ–∫—Å–æ–≤ –∏–ª–∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.

**–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏ (LCK_M_*)**
–ù–∞–π–¥–∏—Ç–µ –≥–ª–∞–≤–Ω—ã–π –±–ª–æ–∫–∏—Ä—É—é—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å:
```sql
-- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –ø—Ä–æ—Ü–µ–¥—É—Ä—É –∏–ª–∏ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ DMV
EXEC sp_whoisactive @find_block_leaders = 1; -- –ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
-- –ò–ª–∏ "—Ä—É—á–Ω–æ–π" –∑–∞–ø—Ä–æ—Å
SELECT session_id, blocking_session_id, wait_type, wait_time, command,
       (SELECT text FROM sys.dm_exec_sql_text(sql_handle)) AS query_text
FROM sys.dm_exec_requests
WHERE blocking_session_id > 0;
```
–£—Å—Ç—Ä–∞–Ω–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å, —Ä–∞–∑–±–µ–π—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ).

**–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø–∞–º—è—Ç—å—é (RESOURCE_SEMAPHORE, PAGELATCH_*)**
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ –∏—Å—á–µ—Ä–ø–∞–Ω–∞ –ª–∏ –ø–∞–º—è—Ç—å, –≤—ã–¥–µ–ª–µ–Ω–Ω–∞—è SQL Server, –∏ –Ω–µ—Ç –ª–∏ –¥–∞–≤–ª–µ–Ω–∏—è —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –û–°. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ `Memory\Available MBytes` –≤ Perfmon.

### üìä –®–∞–≥ 3: –û–±—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–Ω—É—Ç—Ä–∏ SQL Server (–µ—Å–ª–∏ –ø—Ä–∏—á–∏–Ω–∞ –Ω–µ —è—Å–Ω–∞)

–ö–æ–≥–¥–∞ –æ—á–µ–≤–∏–¥–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º —Å —Ä–µ—Å—É—Ä—Å–∞–º–∏ –Ω–µ—Ç, –Ω–æ —Å–µ—Ä–≤–µ—Ä "—Ç—É–ø–∏—Ç", –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —á–∞—Å—Ç—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1.  **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∏–Ω–¥–µ–∫—Å—ã**. **–°–∞–º–∞—è —á–∞—Å—Ç–∞—è –ø—Ä–∏—á–∏–Ω–∞ –≤–Ω–µ–∑–∞–ø–Ω–æ–≥–æ –ø–∞–¥–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ**. –ü–ª–∞–Ω—ã –∑–∞–ø—Ä–æ—Å–æ–≤ —Å—Ç—Ä–æ—è—Ç—Å—è –Ω–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö –æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏.
    - **–ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ/–ø—Ä–æ–≤–µ—Ä–∫–∞**: –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –ø–µ—Ä–µ—Å—Ç—Ä–æ–π—Ç–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω–æ–π –±–∞–∑—ã. –î–ª—è Production —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ –∫–æ–ø–∏–∏ –∏–ª–∏ –≤ –ø–µ—Ä–∏–æ–¥ –Ω–∞–∏–º–µ–Ω—å—à–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏, —Ç–∞–∫ –∫–∞–∫ –ø–µ—Ä–µ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã.
    ```sql
    -- –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –æ–¥–Ω–æ–π –±–∞–∑—ã
    EXEC sp_updatestats;
    ```
2.  **–ü–∞—Ä–∞–º–µ—Ç—Ä `Parameter Sniffing`**. –•—Ä–∞–Ω–∏–º–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞, –∫–æ—Ç–æ—Ä–∞—è –≤—á–µ—Ä–∞ –ª–µ—Ç–∞–ª–∞, —Å–µ–≥–æ–¥–Ω—è –ø–æ–ª–∑–µ—Ç. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–Ω, —Å–æ–∑–¥–∞–Ω–Ω—ã–π –¥–ª—è "–ø–ª–æ—Ö–∏—Ö" –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö –≤—ã–∑–æ–≤–æ–≤.
    - **–ß—Ç–æ –¥–µ–ª–∞—Ç—å**: –í—Ä–µ–º–µ–Ω–Ω–æ –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω–æ–π –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –¥–æ–±–∞–≤—å—Ç–µ `WITH RECOMPILE` –∏–ª–∏ `OPTION (RECOMPILE)` –≤ –∑–∞–ø—Ä–æ—Å –≤–Ω—É—Ç—Ä–∏ –Ω–µ—ë. –î–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è.
3.  **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ `tempdb` –Ω–∞ contention**. –ï—Å–ª–∏ –≤—Å–µ –≤–¥—Ä—É–≥ –Ω–∞—á–∞–ª–æ –º–µ–¥–ª–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å, –∏ –≤—ã –≤–∏–¥–∏—Ç–µ –æ–∂–∏–¥–∞–Ω–∏—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `PFS`, `SGAM` –∏–ª–∏ `PAGELATCH_UP` –≤ `tempdb`, —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
    - **–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–ª—è `tempdb` —Å–æ–∑–¥–∞–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ –¥–∞–Ω–Ω—ã—Ö (–æ–±—ã—á–Ω–æ –ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —è–¥—Ä–æ –¶–ü, –Ω–æ –Ω–µ –±–æ–ª–µ–µ 8), –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞.
4.  **–ó–∞–≥–ª—è–Ω–∏—Ç–µ –≤ –∂—É—Ä–Ω–∞–ª –æ—à–∏–±–æ–∫ SQL** –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–æ—à–∏–±–∫–∞ 833 ‚Äî –æ—á–µ–Ω—å –¥–æ–ª–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –Ω–µ—Ö–≤–∞—Ç–∫–µ –ø–∞–º—è—Ç–∏).

### üíé –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã –∏ –≤—ã–≤–æ–¥

*   **–°–∏—Å—Ç–µ–º–Ω—ã–π –ø–æ–¥—Ö–æ–¥ ‚Äî –∫–ª—é—á**: –°–ª–µ–¥—É–π—Ç–µ –ø–æ —Ü–µ–ø–æ—á–∫–µ: –û–° -> –û–∂–∏–¥–∞–Ω–∏—è SQL -> –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ä–µ—Å—É—Ä—Å (I/O, –¶–ü, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏) -> –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å.
*   **"–ê —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å?"**: –í—Å–µ–≥–¥–∞ –∑–∞–¥–∞–≤–∞–π—Ç–µ —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å. –ù–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å, –≤—ã—Ä–æ—Å—à–∏–π –æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥—Ä–∞–π–≤–µ—Ä–æ–≤?
*   **–ù–µ –ø–∞–Ω–∏–∫—É–π—Ç–µ –∏ —Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ**: –í –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ. –ü–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–µ–ª–∞–π—Ç–µ —Å–Ω–∏–º–∫–∏ –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π (–æ–∂–∏–¥–∞–Ω–∏—è, –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã) –¥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞, —á—Ç–æ–±—ã –±—ã–ª–æ —Å —á–µ–º —Å—Ä–∞–≤–Ω–∏—Ç—å.
*   **–ß—Ç–æ –≤ –≤–∞—à–µ–º –∞—Ä—Å–µ–Ω–∞–ª–µ?** –£–∫–∞–∂–∏—Ç–µ, —Å –∫–∞–∫–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –≤–∞–º –ø—Ä–∏–≤—ã—á–Ω–µ–µ —Ä–∞–±–æ—Ç–∞—Ç—å (Perfmon, Extended Events, —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç—ã –≤—Ä–æ–¥–µ `sp_WhoIsActive`), –∏ —è –º–æ–≥—É –¥–∞—Ç—å –±–æ–ª–µ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –ø–æ –∏—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –≤ —ç—Ç–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏.
*   
