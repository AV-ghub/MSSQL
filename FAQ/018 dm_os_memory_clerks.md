### üìä –û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

–ó–∞–ø—Ä–æ—Å –Ω–∏–∂–µ —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç –∫–ª–µ—Ä–∫–æ–≤ –ø–æ –ø–æ—Ç—Ä–µ–±–ª—è–µ–º–æ–π –ø–∞–º—è—Ç–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Ö —Ç–∏–ø. –≠—Ç–æ –ø–µ—Ä–≤–æ–µ, —á—Ç–æ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ.

```sql
SELECT 
    [type] AS ClerkType,
    [name] AS ClerkName,
    SUM(pages_kb) / 1024.0 AS Memory_MB,  -- –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç—Ä–µ–±–ª—è–µ–º—ã–π —Ä–∞–∑–º–µ—Ä –≤ –ú–ë
    SUM(virtual_memory_reserved_kb) / 1024.0 AS VM_Reserved_MB,  -- –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ –≤ –í–ú
    SUM(virtual_memory_committed_kb) / 1024.0 AS VM_Committed_MB, -- –í—ã–¥–µ–ª–µ–Ω–æ –≤ –í–ú
    SUM(awe_allocated_kb) / 1024.0 AS AWE_Allocated_MB  -- –ü–∞–º—è—Ç—å —á–µ—Ä–µ–∑ AWE (—Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏)
FROM sys.dm_os_memory_clerks
GROUP BY [type], [name]
HAVING SUM(pages_kb) > 0  -- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π
ORDER BY Memory_MB DESC;
```

### üéØ –ö–∞–∫ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –ì–ª–∞–≤–Ω—ã–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –ø–∞–º—è—Ç–∏

–í–æ—Ç —Ç–∏–ø—ã –∫–ª–µ—Ä–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ –≤ —Ç–æ–ø–µ, –∏ —á—Ç–æ –æ–Ω–∏ –æ–∑–Ω–∞—á–∞—é—Ç:

| ClerkType (–¢–∏–ø –∫–ª–µ—Ä–∫–∞) | –ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç | –ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ |
| :--- | :--- | :--- |
| **`MEMORYCLERK_SQLBUFFERPOOL`** | **–ë—É—Ñ–µ—Ä–Ω—ã–π –ø—É–ª**: –∫—ç—à —Å—Ç—Ä–∞–Ω–∏—Ü –¥–∞–Ω–Ω—ã—Ö (8 –ö–ë). | **–°–∞–º—ã–π –∫—Ä—É–ø–Ω—ã–π –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å**. –ï—Å–ª–∏ –æ–Ω –Ω–µ –Ω–∞ –ø–µ—Ä–≤–æ–º –º–µ—Å—Ç–µ ‚Äî —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫. –ï–≥–æ —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–µ–º–∏—Ç—Å—è –∫ `max server memory` –∑–∞ –≤—ã—á–µ—Ç–æ–º –ø–∞–º—è—Ç–∏ –¥—Ä—É–≥–∏—Ö –∫–ª–µ—Ä–∫–æ–≤. |
| **`CACHESTORE_*`** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `CACHESTORE_OBJCP`, `CACHESTORE_SQLCP`, `CACHESTORE_PHDR`) | **–ö—ç—à –ø–ª–∞–Ω–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è** –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (–ø—Ä–æ—Ü–µ–¥—É—Ä—ã, ad-hoc –∑–∞–ø—Ä–æ—Å—ã, –¥–µ—Ä–µ–≤—å—è –∞–ª–≥–µ–±—Ä—ã). | –í—Ç–æ—Ä–æ–π –ø–æ —Ä–∞–∑–º–µ—Ä—É –ø–æ—Å–ª–µ –±—É—Ñ–µ—Ä–Ω–æ–≥–æ –ø—É–ª–∞. –ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä `CACHESTORE_SQLCP` –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–µ–π. |
| **`MEMORYCLERK_SOSNODE`** | **–ü–∞–º—è—Ç—å –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤**: —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (Sort), —Ö—ç—à-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (Hash Join), –∞–≥—Ä–µ–≥–∞—Ü–∏–∏. | –í—Å–ø–ª–µ—Å–∫–∏ –∑–¥–µ—Å—å ‚Äî –ø—Ä–∏–∑–Ω–∞–∫ —Ç—è–∂–µ–ª—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —Å `ORDER BY`, `GROUP BY`, `JOIN`. –ï—Å–ª–∏ –ø–∞–º—è—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∑–∞–Ω—è—Ç–∞ ‚Äî –≤–æ–∑–º–æ–∂–Ω—ã —É—Ç–µ—á–∫–∏ —á–µ—Ä–µ–∑ –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã. |
| **`OBJECTSTORE_LOCK_MANAGER`** | **–•—Ä–∞–Ω–∏–ª–∏—â–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫**. | –ë–æ–ª—å—à–æ–π –æ–±—ä–µ–º —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –æ–≥—Ä–æ–º–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (–≤–æ–∑–º–æ–∂–Ω–æ, –º–∏–ª–ª–∏–æ–Ω—ã). |
| **`MEMORYCLERK_XTP`** | **In-Memory OLTP** (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–ª—è –ø–∞–º—è—Ç–∏ —Ç–∞–±–ª–∏—Ü—ã). | –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –º–µ—Ö–∞–Ω–∏–∑–º–æ–º Hekaton. |
| **`USERSTORE_*`** | –†–∞–∑–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã: –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, —Ç–æ–∫–µ–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —Ç.–¥. | –û–±—ã—á–Ω–æ –Ω–µ–≤–µ–ª–∏–∫–∏. –ê–Ω–æ–º–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã. |

### üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–ª–µ—Ä–∫–æ–≤

#### 1. –ê–Ω–∞–ª–∏–∑ –∫—ç—à–∞ –ø–ª–∞–Ω–æ–≤ (`CACHESTORE_*`)
–≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –ø–æ–∫–∞–∂–µ—Ç, –∫–∞–∫–∏–µ —Ç–∏–ø—ã –ø–ª–∞–Ω–æ–≤ —Å–∫–æ–ª—å–∫–æ –ø–∞–º—è—Ç–∏ —Å—ä–µ–¥–∞—é—Ç, –∏ –ø–æ–º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ ¬´–º—É—Å–æ—Ä¬ª ‚Äî –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ –ø–ª–∞–Ω—ã.

```sql
SELECT 
    [name] AS CacheStoreType,
    COUNT(*) AS PlanCount,
    SUM(size_in_bytes) / 1048576.0 AS TotalSize_MB,
    SUM(CAST(usecounts AS BIGINT)) AS TotalUseCount,
    -- –°—Ä–µ–¥–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø–ª–∞–Ω: —á–µ–º –Ω–∏–∂–µ, —Ç–µ–º –±–æ–ª—å—à–µ "–º—É—Å–æ—Ä–∞"
    AVG(CAST(usecounts AS DECIMAL)) AS AvgUseCount
FROM sys.dm_os_memory_clerks AS cl
CROSS APPLY sys.dm_exec_cached_plans AS cp
WHERE cl.[type] LIKE 'CACHESTORE%'
GROUP BY [name]
ORDER BY TotalSize_MB DESC;
```

**–ö–∞–∫ –æ—Ü–µ–Ω–∏—Ç—å**: –ï—Å–ª–∏ –¥–ª—è `CACHESTORE_SQLCP` (Ad-hoc –∑–∞–ø—Ä–æ—Å—ã) `AvgUseCount` –±–ª–∏–∑–æ–∫ –∫ 1, –∞ `TotalSize_MB` –≤–µ–ª–∏–∫ ‚Äî —ç—Ç–æ –ø—Ä–∏–∑–Ω–∞–∫ **–ø—Ä–æ–±–ª–µ–º—ã —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–µ–π**. –ö–∞–∂–¥—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ, –∑–∞—Å–æ—Ä—è—è –ø–∞–º—è—Ç—å.

#### 2. –ê–Ω–∞–ª–∏–∑ –ø–∞–º—è—Ç–∏ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ (`MEMORYCLERK_SOSNODE`)
–≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –ø–æ–∫–∞–∂–µ—Ç, –∫–∞–∫–∏–µ –∏–º–µ–Ω–Ω–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ –∫–ª–µ—Ä–∫–∞ –ø–æ—Ç—Ä–µ–±–ª—è—é—Ç –ø–∞–º—è—Ç—å.

```sql
SELECT 
    [type] AS NodeType,
    SUM(pages_kb) / 1024.0 AS Memory_MB
FROM sys.dm_os_memory_clerks
WHERE [type] = 'MEMORYCLERK_SOSNODE'
GROUP BY [type]
-- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —Å–µ—Å—Å–∏—è–º (–∫—Ç–æ —Å–µ–π—á–∞—Å —Ç—Ä–∞—Ç–∏—Ç –ø–∞–º—è—Ç—å –Ω–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏/—Ö—ç—à–∏)
-- –ò—Å–ø–æ–ª—å–∑—É–µ–º dm_exec_query_memory_grants
SELECT 
    session_id,
    requested_memory_kb / 1024 AS Requested_MB,
    granted_memory_kb / 1024 AS Granted_MB,
    used_memory_kb / 1024 AS Used_MB,
    query_plan  -- –í–∫–ª—é—á–∞–µ–º –ø–ª–∞–Ω –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
FROM sys.dm_exec_query_memory_grants
ORDER BY granted_memory_kb DESC;
```

**–ö–∞–∫ –æ—Ü–µ–Ω–∏—Ç—å**: –ï—Å–ª–∏ `MEMORYCLERK_SOSNODE` –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∑–∞–Ω–∏–º–∞–µ—Ç –≥–∏–≥–∞–±–∞–π—Ç—ã ‚Äî –∏—â–∏—Ç–µ —Ç—è–∂–µ–ª—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –≤ –ø–∞–º—è—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ—Ç –ª–∏ `spills` –≤ `tempdb` (–ø—Ä–∏–∑–Ω–∞–∫ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –≥—Ä–∞–Ω—Ç–æ–≤).

#### 3. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ü–µ–ª–µ–≤—ã–º —Ä–∞–∑–º–µ—Ä–æ–º –ø–∞–º—è—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞
–≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –¥–∞—Å—Ç –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç–∏–Ω—É: —Å–∫–æ–ª—å–∫–æ –ø–∞–º—è—Ç–∏ —Ö–æ—á–µ—Ç —Å–µ—Ä–≤–µ—Ä, —Å–∫–æ–ª—å–∫–æ –≤—ã–¥–µ–ª–∏–ª –∏ –∫–∞–∫ –æ–Ω–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∞.

```sql
-- 1. –¶–µ–ª–µ–≤–∞—è –∏ —Ç–µ–∫—É—â–∞—è –ø–∞–º—è—Ç—å —Å–µ—Ä–≤–µ—Ä–∞
SELECT 
    (committed_kb / 1024) AS Total_Server_Memory_MB,
    (committed_target_kb / 1024) AS Target_Server_Memory_MB,
    (committed_kb * 1.0 / committed_target_kb) * 100 AS Percent_Of_Target
FROM sys.dm_os_sys_info;

-- 2. –°—É–º–º–∞—Ä–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –≤—Å–µ–º–∏ –∫–ª–µ—Ä–∫–∞–º–∏ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–ª–∏–∑–∫–æ –∫ Total_Server_Memory)
SELECT SUM(pages_kb) / 1024.0 AS All_Clerks_Total_MB
FROM sys.dm_os_memory_clerks;

-- 3. –¢–æ–ø-10 –∫–ª–µ—Ä–∫–æ–≤ —Å –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º –æ—Ç –æ–±—â–µ–π –ø–∞–º—è—Ç–∏
;WITH TotalClerkMemory AS (
    SELECT SUM(pages_kb) AS TotalPagesKb FROM sys.dm_os_memory_clerks
)
SELECT TOP 10
    mc.[type],
    mc.[name],
    SUM(mc.pages_kb) / 1024.0 AS Memory_MB,
    ROUND((SUM(mc.pages_kb) * 100.0) / t.TotalPagesKb, 2) AS Percent_Of_Total
FROM sys.dm_os_memory_clerks mc
CROSS JOIN TotalClerkMemory t
GROUP BY mc.[type], mc.[name], t.TotalPagesKb
ORDER BY Memory_MB DESC;
```

### üö® –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –í–Ω–µ–∑–∞–ø–Ω—ã–π —Ä–æ—Å—Ç –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏**
1.  –í—ã–ø–æ–ª–Ω–∏—Ç–µ **–æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å** –∏ –Ω–∞–π–¥–∏—Ç–µ –∫–ª–µ—Ä–∫, —É –∫–æ—Ç–æ—Ä–æ–≥–æ `Memory_MB` —Ä–µ–∑–∫–æ –≤—ã—Ä–æ—Å.
2.  –ï—Å–ª–∏ —ç—Ç–æ `CACHESTORE_SQLCP` ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–∏—à–ª–∞ –≤–æ–ª–Ω–∞ –Ω–µ–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
3.  –ï—Å–ª–∏ —ç—Ç–æ `MEMORYCLERK_SOSNODE` ‚Äî –∏—â–∏—Ç–µ –Ω–æ–≤—ã–µ —Ç—è–∂–µ–ª—ã–µ –æ—Ç—á–µ—Ç—ã –∏–ª–∏ ETL-–ø—Ä–æ—Ü–µ—Å—Å—ã.
4.  –ï—Å–ª–∏ —ç—Ç–æ `MEMORYCLERK_SQLBUFFERPOOL` ‚Äî —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ—Å—Ç–æ –∫—ç—à–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –Ω–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏ (Pressure)**
1.  –ü—Ä–æ–≤–µ—Ä—å—Ç–µ **–ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç —Ü–µ–ª–µ–≤–æ–π –ø–∞–º—è—Ç–∏** (`Percent_Of_Target`). –ï—Å–ª–∏ –æ–Ω —Å—Ç–∞–±–∏–ª—å–Ω–æ >95% ‚Äî —Å–µ—Ä–≤–µ—Ä—É —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –û–ó–£.
2.  –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ **—Ç–æ–ø –∫–ª–µ—Ä–∫–æ–≤**. –ï—Å–ª–∏ `MEMORYCLERK_SQLBUFFERPOOL` –∑–∞–Ω–∏–º–∞–µ—Ç –º–µ–Ω–µ–µ 70-80% –æ—Ç –æ–±—â–µ–π –ø–∞–º—è—Ç–∏ SQL Server, –∑–Ω–∞—á–∏—Ç, –¥—Ä—É–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (—á–∞—Å—Ç–æ `CACHESTORE_*`) ¬´–≤–æ—Ä—É—é—Ç¬ª –ø–∞–º—è—Ç—å —É –±—É—Ñ–µ—Ä–Ω–æ–≥–æ –ø—É–ª–∞.
3.  **–†–µ—à–µ–Ω–∏–µ**: –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –ø–ª–∞–Ω–æ–≤ (`DBCC FREESYSTEMCACHE('SQL Plans')`) –¥–∞—Å—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–±–ª–µ–≥—á–µ–Ω–∏–µ, –Ω–æ –Ω—É–∂–Ω–æ –∏—Å–∫–∞—Ç—å –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—é).

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –Ω–∞ —É—Ç–µ—á–∫—É –ø–∞–º—è—Ç–∏**
–£—Ç–µ—á–∫–∞ ‚Äî –∫–æ–≥–¥–∞ –ø–∞–º—è—Ç—å –∫–ª–µ—Ä–∫–∞ **–º–æ–Ω–æ—Ç–æ–Ω–Ω–æ —Ä–∞—Å—Ç–µ—Ç –∏ –Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è** –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏.
1.  **–°–Ω–∏–º–∏—Ç–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è** –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º –≤ 5-10 –º–∏–Ω—É—Ç –≤ –ø–µ—Ä–∏–æ–¥ –ø—Ä–æ—Å—Ç–æ—è.
2.  –ï—Å–ª–∏ `MEMORYCLERK_SOSNODE` –∏–ª–∏ `USERSTORE_*` –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞—Å—Ç—É—Ç ‚Äî –≤–æ–∑–º–æ–∂–Ω–∞ —É—Ç–µ—á–∫–∞ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ SQL Server (—Ä–µ–¥–∫–æ, –Ω–æ –±—ã–≤–∞–µ—Ç). –¢—Ä–µ–±—É–µ—Ç—Å—è –≥–ª—É–±–æ–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞.

### üí° –ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è –ø–∞–º—è—Ç–∏:

```sql
CREATE VIEW vw_MemoryHealth AS
-- 1. –û–±—â–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ –ø–æ –∫–ª–µ—Ä–∫–∞–º
SELECT 
    GETDATE() AS CheckTime,
    (SELECT (committed_kb / 1024) FROM sys.dm_os_sys_info) AS Total_Used_MB,
    (SELECT (committed_target_kb / 1024) FROM sys.dm_os_sys_info) AS Target_MB,
    (
        SELECT SUM(pages_kb) / 1024.0
        FROM sys.dm_os_memory_clerks 
        WHERE [type] = 'MEMORYCLERK_SQLBUFFERPOOL'
    ) AS BufferPool_MB,
    (
        SELECT SUM(pages_kb) / 1024.0
        FROM sys.dm_os_memory_clerks 
        WHERE [type] LIKE 'CACHESTORE%'
    ) AS PlanCache_MB,
    (
        SELECT SUM(pages_kb) / 1024.0
        FROM sys.dm_os_memory_clerks 
        WHERE [type] = 'MEMORYCLERK_SOSNODE'
    ) AS QueryExecution_MB;
```

### üìù –ì–ª–∞–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

1.  **`MEMORYCLERK_SQLBUFFERPOOL` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–∞–º—ã–º –±–æ–ª—å—à–∏–º**. –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ —Ç–∞–∫ ‚Äî –∏—â–∏—Ç–µ –∞–Ω–æ–º–∞–ª–∏–∏ –≤ –¥—Ä—É–≥–∏—Ö –∫–ª–µ—Ä–∫–∞—Ö.
2.  **`CACHESTORE_*` ‚Äî –≤—Ç–æ—Ä–æ–π –ø–æ —Ä–∞–∑–º–µ—Ä—É, –Ω–æ –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ–ø–µ—Ä–Ω–∏—á–∞—Ç—å —Å –±—É—Ñ–µ—Ä–Ω—ã–º –ø—É–ª–æ–º**. –ë–æ–ª—å—à–æ–π –∫—ç—à –ø–ª–∞–Ω–æ–≤ —Å `usecounts = 1` ‚Äî —ç—Ç–æ –º—É—Å–æ—Ä.
3.  **`MEMORYCLERK_SOSNODE` ‚Äî –≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å**. –ü–æ—Å—Ç–æ—è–Ω–Ω–æ –≤—ã—Å–æ–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã.
4.  **–°—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ —Å `Target Server Memory`**. –ï—Å–ª–∏ —Å—É–º–º–∞ –≤—Å–µ—Ö –∫–ª–µ—Ä–∫–æ–≤ –±–ª–∏–∑–∫–∞ –∫ Target –∏ Target –±–ª–∏–∑–æ–∫ –∫ `max server memory` ‚Äî —Å–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å—ë, —á—Ç–æ –º–æ–∂–µ—Ç. –í–æ–ø—Ä–æ—Å –≤ —Ç–æ–º, —Ö–≤–∞—Ç–∞–µ—Ç –ª–∏ –µ–º—É —ç—Ç–æ–≥–æ.

**–ö–ª—é—á–µ–≤–æ–π –≤–æ–ø—Ä–æ—Å –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏**: *–ö–∞–∫–æ–π –∫–ª–µ—Ä–∫ —Å—ä–µ–ª –ø–∞–º—è—Ç—å, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ –¥–æ—Å—Ç–∞—Ç—å—Å—è –±—É—Ñ–µ—Ä–Ω–æ–º—É –ø—É–ª—É?* –û—Ç–≤–µ—Ç –Ω–∞ –Ω–µ–≥–æ –≤ 90% —Å–ª—É—á–∞–µ–≤ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –∫–æ—Ä–Ω—é –ø—Ä–æ–±–ª–µ–º—ã.
